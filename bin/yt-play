#!/bin/sh
PLAYER=""
PLAYERS="omxplayer mplayer"
FIFONAME='myfifo'
for a in ${PLAYERS} ; do
	type $a >/dev/null 2>&1
	if [ $? = 0 ]; then
		PLAYER=$a
		break
	fi
done
if [ -z "${PLAYER}" ]; then
	echo "Cannot find a valid player"
	exit 1
fi
type youtube-dl >/dev/null 2>&1
if [ ! $? = 0 ]; then
	echo "Cannot find youtube-dl"
	exit 2
fi

foo() {
	pkill python # :D
	rm -f ${FIFONAME}
}

waitfifo () {

	for x in 1 2 3 4 5; do
		[ ! -e ${FIFONAME} ] && return
		echo 'waiting for previous player to die ...'
		sleep 1
	done
	echo 'giving up'
	rm -f ${FIFONAME}
}

trap foo INT
pkill ${PLAYER} ; waitfifo ; mkfifo ${FIFONAME}
(
	${PLAYER} ${FIFONAME}
	foo
) &
youtube-dl --no-part -o ${FIFONAME} $@
